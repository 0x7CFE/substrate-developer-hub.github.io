<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Creating a Custom Substrate chain · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;This document will walk you through the steps required to duplicate the demo that &lt;a href=&quot;https://youtu.be/0IoUZdDi5Is&quot;&gt;Gavin Wood presented at the 2018 Web3 Summit&lt;/a&gt;, showing off how you can build a Runtime Library for a Substrate Blockchain in less than 30 min.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Creating a Custom Substrate chain · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="&lt;p&gt;This document will walk you through the steps required to duplicate the demo that &lt;a href=&quot;https://youtu.be/0IoUZdDi5Is&quot;&gt;Gavin Wood presented at the 2018 Web3 Summit&lt;/a&gt;, showing off how you can build a Runtime Library for a Substrate Blockchain in less than 30 min.&lt;/p&gt;
"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/Substrate-logo.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/quickstart/installing-substrate" target="_self">Docs</a></li><li class=""><a href="/en/tutorials" target="_self">Tutorials</a></li><li class=""><a href="https://www.parity.io/blog/" target="_self">Blog</a></li><li class=""><a href="/community/support" target="_self">Community</a></li><li class=""><a href="https://github.com/substrate-developer-hub/" target="_self">GitHub</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/zh-CN/tutorials/creating-a-custom-substrate-chain">中文</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Tutorials</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Quick Start</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/en/quickstart/installing-substrate">Installing Substrate</a></li><li class="navListItem"><a class="navItem" href="/docs/en/quickstart/using-the-substrate-node-and-module-setup-scripts">Using the Substrate node and module setup scripts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Runtime</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Macros</h4><ul><li class="navListItem"><a class="navItem" href="/docs/en/runtime/macros/construct_runtime">Constructing a Runtime!</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/macros/decl_module">Declaring a Module!</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/macros/decl_storage">runtime/macros/decl_storage</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Types</h4><ul><li class="navListItem"><a class="navItem" href="/docs/en/runtime/types/call-enum">Call Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/types/event-enum">Event Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/types/genesisconfig-struct">GenesisConfig Struct</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/en/runtime/architecture-of-a-runtime">Architecture of a Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/runtime-and-api">Runtime and API</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/substrate-runtime-module-library">Substrate Runtime Module Library</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Substrate Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/en/overview/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/low-level-data-format">Low-level Data Format</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/substrate-bonds">overview/substrate-bonds</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/telemetry">Telemetry</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/transaction-lifecycle">Transaction Lifecycle</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/versioning">Versioning</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/building-a-token-curated-registry-dappchain">Building a Token Curated Registry DAppChain</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/tutorials/creating-a-custom-substrate-chain">Creating a Custom Substrate chain</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/deploying-a-smart-contract-on-a-substrate-node-chain">Deploying a Smart Contract on a Substrate Node Chain</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/start-a-private-network-with-substrate">Start a Private Network with Substrate</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/keys--seeds--and-the--subkey--tool">Keys, Seeds, and the `subkey` Tool</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/governance--public--mechanism-with-a-substrate-node-chain">Governance &quot;Public&quot; Mechanism with a Substrate Node Chain</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/migrating-storage-to-a-new-substrate-node-s-runtime">Migrating Storage to a new Substrate Node&#x27;s Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/substrate-collectables-workshop">tutorials/substrate-collectables-workshop</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/substrate-runtime-recipes">Substrate Runtime Recipes</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/validator-nodes-and-nominators-on-substrate-chains">Validator Nodes and Nominators on Substrate chains</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Creating a Custom Substrate chain</h1></header><article><div><span><p>This document will walk you through the steps required to duplicate the demo that <a href="https://youtu.be/0IoUZdDi5Is">Gavin Wood presented at the 2018 Web3 Summit</a>, showing off how you can build a Runtime Library for a Substrate Blockchain in less than 30 min.</p>
<p>This tutorial will be written for a Mac OS X machine, and may require some finessing to get working on other operating systems.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<p>To start, make sure your machine has the latest <a href="https://www.npmjs.com/get-npm">node and npm</a> installed. Then you're ready to <a href="quickstart/installing-substrate">install substrate</a> itself. It may take a little while, so grab some tea and <a href="http://tiny.cc/substrate-getting-started">optionally walk through this presentation</a>.</p>
<p>You will also need to set up a few more repositories into your working folder which were used in the demo:</p>
<ul>
<li><a href="https://github.com/paritytech/substrate/tree/master/node-template">Substrate Node Template</a></li>
<li><a href="https://github.com/paritytech/substrate-ui">Substrate UI</a></li>
</ul>
<p>You can do that with some <a href="https://github.com/paritytech/substrate-up">script aliases</a> that were loaded on your machine. You may need to restart your terminal in order for these scripts and other Substrate commands to become available to you.</p>
<pre><code class="hljs css language-bash">substrate-node-new substrate-node-template &lt;author-name&gt;
substrate-ui-new substrate
</code></pre>
<p>This will create a folder called <code>substrate-node-template</code> and <code>substrate-ui</code> with the corresponding repositories cloned in them. You can of course rename your projects in these commands, but for the sake of the clarity, we will continue with these folder names.</p>
<h2><a class="anchor" aria-hidden="true" id="launch-a-blockchain"></a><a href="#launch-a-blockchain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Launch a Blockchain</h2>
<p>If you have set up everything correctly, you can now start a substrate dev chain! In the <code>substrate-node-template</code> folder, you can run the generated executable with:</p>
<pre><code class="hljs css language-bash">./target/release/substrate-node-template --dev
</code></pre>
<p>If you run into any errors starting or running your node, you may need to purge the chain files on your computer. You can do this by running: <code>./target/release/substrate-node-template purge-chain --dev</code>.</p>
<p>If everything is working it should start producing blocks!</p>
<p>To interact with the blockchain, you need to start the Substrate UI. Navigate to the <code>substrate-ui</code> folder and run:</p>
<pre><code class="hljs css language-bash">yarn run dev
</code></pre>
<p>Finally, if open your browser to <code>http://localhost:8000</code>, you should be able to interact with your new chain!</p>
<h2><a class="anchor" aria-hidden="true" id="step-2-add-alice-to-your-network"></a><a href="#step-2-add-alice-to-your-network" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 2: Add Alice to your network</h2>
<p>Alice is a hard-coded account in your blockchain's <a href="https://github.com/paritytech/substrate/blob/master/node-template/src/chain_spec.rs#L43">genesis block configuration</a>. To make your life easier, this account is automatically pre-funded with currency and made a &quot;super user&quot; to your blockchain's upgrade system.</p>
<p>To access the &quot;Alice&quot; account, go to the <code>Wallet</code> section of the Substrate UI, and add Alice using her name and seed URI: <code>//Alice</code>.</p>
<p><img src="https://i.imgur.com/ItPlikV.png" alt="Adding Alice to your wallet"></p>
<p>If all is working correctly, you can now go into the <code>Send Funds</code> section and send funds from <code>Alice</code> to <code>Default</code>. You will see that Alice has a bunch of <code>units</code> pre-funded in her account, so send 5000 and wait for the green checkmark and an updated balance for <code>Default</code> to show that the transfer has been successfully recorded on the blockchain.</p>
<p><img src="https://i.imgur.com/8IIg292.png" alt="Sending funds from Alice to your default account"></p>
<h2><a class="anchor" aria-hidden="true" id="step-3-create-a-new-runtime-module"></a><a href="#step-3-create-a-new-runtime-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 3: Create a new runtime module</h2>
<p>Now it's time to create our own runtime.</p>
<p>Open up the <code>substrate-node-template</code> folder and create a new file:</p>
<pre><code class="hljs css language-bash">./runtime/src/demo.rs
</code></pre>
<p>This is where our new runtime module will live. Inline comments will hopefully give you insight to what the code is doing.</p>
<p>First, we will need to import a few libraries at the top of our file:</p>
<pre><code class="hljs css language-rust"><span class="hljs-comment">// Encoding library</span>
<span class="hljs-keyword">use</span> parity_codec::Encode;

<span class="hljs-comment">// Enables access to store a value in runtime storage</span>
<span class="hljs-comment">// Imports the `Result` type that is returned from runtime functions</span>
<span class="hljs-comment">// Imports the `decl_module!` and `decl_storage!` macros</span>
<span class="hljs-keyword">use</span> support::{StorageValue, dispatch::<span class="hljs-built_in">Result</span>, decl_module, decl_storage};

<span class="hljs-comment">// Traits used for interacting with Substrate's Balances module</span>
<span class="hljs-comment">// `Currency` gives you access to interact with the on-chain currency</span>
<span class="hljs-comment">// `WithdrawReason` and `ExistenceRequirement` are enums for balance functions</span>
<span class="hljs-keyword">use</span> support::traits::{Currency, WithdrawReason, ExistenceRequirement};

<span class="hljs-comment">// These are traits which define behavior around math and hashing</span>
<span class="hljs-keyword">use</span> runtime_primitives::traits::{Zero, Hash, Saturating};

<span class="hljs-comment">// Enables us to verify an call to our module is signed by a user account</span>
<span class="hljs-keyword">use</span> system::ensure_signed;
</code></pre>
<p>All modules need to declare a trait named <code>Trait</code> which is used to define the unique types needed by the module. In this case, our module does not have any unique types of it own, but does inherit types from the balances module such as a <code>Balance</code>, which is the currency of our system.</p>
<pre><code class="hljs css language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span>: balances::Trait {}
</code></pre>
<p>In this example, we will create a simple coin flip game. Users will pay an entry fee to play the game and then &quot;flip a coin&quot;. If they win they will get the contents of the pot. If they don't win, they will get nothing. No matter the outcome, their fee will be placed into the pot after the game resolves for the next user to try and win.</p>
<p>To start, we can define the storage items our module needs to track with the <a href="/docs/en/runtime/macros/decl_storage"><code>decl_storage!</code> macro</a>:</p>
<pre><code class="hljs css language-rust">decl_storage! {
  <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Store</span></span> <span class="hljs-keyword">for</span> Module&lt;T: Trait&gt; <span class="hljs-keyword">as</span> Demo {
    Payment get(payment): <span class="hljs-built_in">Option</span>&lt;T::Balance&gt;;
    Pot get(pot): T::Balance;
    Nonce get(nonce): <span class="hljs-built_in">u64</span>;
  }
}
</code></pre>
<p>A macro is code in Rust which can be used to generate other code. Here we have introduced a macro and custom syntax to make the declaration of storage simple and easy to read. This macro will take care of generating all of the proper code needed to actually interact with the Substrate storage database.</p>
<p>You can see in our storage, we have three items, two of which track a <code>Balance</code>, and one that tracks a nonce which is represented as a <code>u64</code>. <code>Payment</code> uses an <code>Option</code> to wrap the balance so that we can represent whether or not the <code>Payment</code> has been initialized with a value. Easy enough :)</p>
<p>Next we will need to define our dispatchable functions: the ones that a user can use to call into our blockchain system. This game will have two functions the user can interact with: one that lets us set the initial payment, and one that lets us play the game.</p>
<pre><code class="hljs css language-rust">decl_module! {
    <span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Module</span></span>&lt;T: Trait&gt; <span class="hljs-keyword">for</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Call</span></span> <span class="hljs-keyword">where</span> origin: T::Origin {
        <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">set_payment</span></span>(_origin, value: T::Balance) -&gt; <span class="hljs-built_in">Result</span> {
              <span class="hljs-comment">// Logic for setting the game payment</span>
        }

        play(origin) -&gt; <span class="hljs-built_in">Result</span> {
              <span class="hljs-comment">// Logic for playing the game</span>
        }
    }
}
</code></pre>
<p>Now that we have established our module structure, we can add the logic which powers these functions. First, we will write the logic for initializing our storage items:</p>
<pre><code class="hljs css language-rust"><span class="hljs-comment">// This function initializes the `payment` storage item</span>
<span class="hljs-comment">// It also populates the pot with an initial value</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">set_payment</span></span>(origin, value: T::Balance) -&gt; <span class="hljs-built_in">Result</span> {
  <span class="hljs-comment">// Ensure that the function call is a signed message (i.e. a transaction)</span>
  <span class="hljs-keyword">let</span> _ = ensure_signed(origin)?;

  <span class="hljs-comment">// If `payment` is not initialized with some value</span>
  <span class="hljs-keyword">if</span> Self::payment().is_none() {
    <span class="hljs-comment">// Set the value of `payment`</span>
    &lt;Payment&lt;T&gt;&gt;::put(value);

    <span class="hljs-comment">// Initialize the `pot` with the same value</span>
    &lt;Pot&lt;T&gt;&gt;::put(value);
  }

  <span class="hljs-comment">// Return Ok(()) when everything happens successfully</span>
  <span class="hljs-literal">Ok</span>(())
}
</code></pre>
<p>Then we will write the <code>play()</code> function which will actually allow users to play our game.</p>
<pre><code class="hljs css language-rust"><span class="hljs-comment">// This function is allows a user to play our coin-flip game</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">play</span></span>(origin) -&gt; <span class="hljs-built_in">Result</span> {
  <span class="hljs-comment">// Ensure that the function call is a signed message (i.e. a transaction)</span>
  <span class="hljs-comment">// Additionally, derive the sender address from the signed message</span>
  <span class="hljs-keyword">let</span> sender = ensure_signed(origin)?;

  <span class="hljs-comment">// Ensure that `payment` storage item has been set</span>
  <span class="hljs-keyword">let</span> payment = Self::payment().ok_or(<span class="hljs-string">"Must have payment amount set"</span>)?;

  <span class="hljs-comment">// Read our storage values, and place them in memory variables</span>
  <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> nonce = Self::nonce();
  <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> pot = Self::pot();

  <span class="hljs-comment">// Try to withdraw the payment from the account, making sure that it will not kill the account</span>
  <span class="hljs-keyword">let</span> _ = &lt;balances::Module&lt;T&gt; <span class="hljs-keyword">as</span> Currency&lt;_&gt;&gt;::withdraw(&amp;sender, payment, WithdrawReason::Reserve, ExistenceRequirement::KeepAlive)?;

  <span class="hljs-comment">// Generate a random hash between 0-255 using a csRNG algorithm</span>
  <span class="hljs-keyword">if</span> (&lt;system::Module&lt;T&gt;&gt;::random_seed(), &amp;sender, nonce)
    .using_encoded(&lt;T <span class="hljs-keyword">as</span> system::Trait&gt;::Hashing::hash)
    .using_encoded(|e| e[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">128</span>)
    {
      <span class="hljs-comment">// If the user won the coin flip, deposit the pot winnings; cannot fail</span>
      <span class="hljs-keyword">let</span> _ = &lt;balances::Module&lt;T&gt; <span class="hljs-keyword">as</span> Currency&lt;_&gt;&gt;::deposit_into_existing(&amp;sender, pot)
        .expect(<span class="hljs-string">"`sender` must exist since a transaction is being made and withdraw will keep alive; qed."</span>);

      <span class="hljs-comment">// Reduce the pot to zero</span>
      pot = Zero::zero();
  }

  <span class="hljs-comment">// No matter the outcome, increase the pot by the payment amount</span>
  pot = pot.saturating_add(payment);

  <span class="hljs-comment">// Increment the nonce</span>
  nonce = nonce.wrapping_add(<span class="hljs-number">1</span>);

  <span class="hljs-comment">// Store the updated values for our module</span>
  &lt;Pot&lt;T&gt;&gt;::put(pot);
  &lt;Nonce&lt;T&gt;&gt;::put(nonce);

  <span class="hljs-comment">// Return Ok(()) when everything happens successfully</span>
  <span class="hljs-literal">Ok</span>(())
}
</code></pre>
<p>And that's it! This is how easy it can be to build new runtime modules using Substrate. You can also reference a <a href="https://github.com/shawntabrizi/substrate-package/blob/gav-demo/substrate-node-template/runtime/src/demo.rs">complete version</a> of this file to check your work.</p>
<h2><a class="anchor" aria-hidden="true" id="step-4-integrate-our-new-module-into-our-runtime"></a><a href="#step-4-integrate-our-new-module-into-our-runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 4: Integrate our new module into our runtime</h2>
<p>To actually use our module, we need to tell our runtime that it exists. To do this we will be modifying the <code>./runtime/src/lib.rs</code> file:</p>
<p>First, we need to include the new file we created into our project:</p>
<pre><code class="hljs css language-rust">...
<span class="hljs-comment">/// Index of an account's extrinsic in the chain.</span>
<span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Nonce</span></span> = <span class="hljs-built_in">u64</span>;

<span class="hljs-keyword">mod</span> demo;     <span class="hljs-comment">// Add this line</span>
</code></pre>
<p>Next, we need to tell our runtime about the <code>Trait</code> we exposed within the demo module.</p>
<pre><code class="hljs css language-rust">...
<span class="hljs-keyword">impl</span> sudo::Trait <span class="hljs-keyword">for</span> Runtime {
  <span class="hljs-comment">/// The uniquitous event type.</span>
  <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Event</span></span> = Event;
  <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Proposal</span></span> = Call;
}

<span class="hljs-keyword">impl</span> demo::Trait <span class="hljs-keyword">for</span> Runtime {}      <span class="hljs-comment">// Add this line</span>
</code></pre>
<p>Finally, we need to include our demo module in the runtime constructor, which is handled by the <code>construct_runtime!</code> macro:</p>
<pre><code class="hljs css language-rust">construct_runtime!(
  <span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Runtime</span></span> with Log(InternalLog: DigestItem&lt;Hash, Ed25519AuthorityId&gt;) <span class="hljs-keyword">where</span>
    Block = Block,
    NodeBlock = opaque::Block,
    UncheckedExtrinsic = UncheckedExtrinsic
  {
    System: system::{<span class="hljs-keyword">default</span>, Log(ChangesTrieRoot)},
    Timestamp: timestamp::{Module, Call, Storage, Config&lt;T&gt;, Inherent},
    Consensus: consensus::{Module, Call, Storage, Config&lt;T&gt;, Log(AuthoritiesChange), Inherent},
    Aura: aura::{Module},
    Indices: indices,
    Balances: balances,
    Sudo: sudo,
    Demo: demo::{Module, Call, Storage},    <span class="hljs-comment">// Add this line</span>
  }
);
</code></pre>
<p>To make it more clear when our upgrade is successful, we can also update the name of our runtime's specification and implementation:</p>
<pre><code class="hljs css language-rust"><span class="hljs-comment">/// This runtime version.\npub const VERSION: RuntimeVersion = RuntimeVersion {</span>
  spec_name: create_runtime_str!(<span class="hljs-string">"demo"</span>),      <span class="hljs-comment">// Update this name</span>
  impl_name: create_runtime_str!(<span class="hljs-string">"demo-node"</span>), <span class="hljs-comment">// Update this name</span>
  authoring_version: <span class="hljs-number">3</span>,
  spec_version: <span class="hljs-number">3</span>,
  impl_version: <span class="hljs-number">0</span>,
  apis: RUNTIME_API_VERSIONS,
};
</code></pre>
<p>Again, you can find a <a href="https://github.com/shawntabrizi/substrate-package/blob/gav-demo/substrate-node-template/runtime/src/lib.rs">complete version</a> of this file.</p>
<h2><a class="anchor" aria-hidden="true" id="step-5-upgrade-our-chain"></a><a href="#step-5-upgrade-our-chain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 5: Upgrade our chain</h2>
<p>Now that we have created a new runtime module, it's time for us to upgrade our blockchain.</p>
<p>To do this, first we will need to compile our new runtime into a Wasm binary. Go into <code>substrate-node-template</code> and run:</p>
<pre><code class="hljs">./scripts/build.sh
</code></pre>
<p>If this completes successfully, it will update the file: <code>./runtime/wasm/target/wasm32-unknown-unknown/release/node_runtime.compact.wasm</code>. You can go back to the Substrate UI, and in the <code>Runtime Upgrade</code> section, you can select this file and press <code>upgrade</code>.</p>
<p><img src="https://i.imgur.com/c0O2Pnf.png" alt="Successful chain upgrade"></p>
<p>If all went well, you can see at the top of the Substrate UI that the <code>Runtime</code> will have our updated name!</p>
<p><img src="https://i.imgur.com/PLe219L.png" alt="An image of an updated runtime name"></p>
<h2><a class="anchor" aria-hidden="true" id="step-6-interacting-with-our-new-module"></a><a href="#step-6-interacting-with-our-new-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 6: Interacting with our new module</h2>
<p>Finally, we can try and play the game we created. We will begin our interaction through the browser console.</p>
<p>On the page with the Substrate UI, press <em>F12</em> to open your developer console. We will take advantage of some of the JavaScript libraries loaded on this page.</p>
<p>Before we can play the game, we need to initialize the <code>set_payment</code> from an account. We will call the function on behalf of Alice, who will generously initialize the pot with a signed message.</p>
<pre><code class="hljs css language-javascript">post({
  <span class="hljs-attr">sender</span>: runtime.indices.ss58Decode(<span class="hljs-string">'F7Hs'</span>),
  <span class="hljs-attr">call</span>: calls.demo.setPayment(<span class="hljs-number">1000</span>),
}).tie(<span class="hljs-built_in">console</span>.log)
</code></pre>
<p><img src="https://i.imgur.com/nl0h2Ei.png" alt="Setting the payment in the developer console"></p>
<p>When this call completed, you should see <code>{finalized: &quot;...&quot;}</code>, showing that it has been added to the chain. We can check this by reading the balance in the pot:</p>
<pre><code class="hljs css language-javascript">runtime.demo.pot.then(<span class="hljs-built_in">console</span>.log)
</code></pre>
<p>Which should return <code>Number {1000}</code></p>
<h2><a class="anchor" aria-hidden="true" id="step-7-updating-our-substrate-ui"></a><a href="#step-7-updating-our-substrate-ui" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 7: Updating our Substrate UI</h2>
<p>Now that we see things are working in the background, it's time to give our UI some new legs. Let's add an interface so that someone can play our game. To do this we will need to modify the <code>substrate-ui</code> repository.</p>
<p>Open the <code>./src/app.jsx</code> file, and in the <code>readyRender()</code> function, you will see the code which generates all the different UX components.</p>
<p>For example, this code snippet controls the Runtime Upgrade UX that we most recently interacted with:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpgradeSegment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>()
    <span class="hljs-keyword">this</span>.conditionBond = runtime.metadata.map(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span>
      m.modules &amp;&amp; m.modules.some(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.name === <span class="hljs-string">'sudo'</span>)
      || m.modules.some(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.name === <span class="hljs-string">'upgrade_key'</span>)
      )
    <span class="hljs-keyword">this</span>.runtime = <span class="hljs-keyword">new</span> Bond
  }

  render() {
    <span class="hljs-keyword">return</span> &lt;If condition={this.conditionBond} then={
      &lt;Segment style={{ margin: '1em' }} padded&gt;
        &lt;Header as='h2'&gt;
          &lt;Icon name='search' /&gt;
          &lt;Header.Content&gt;
            Runtime Upgrade
            &lt;Header.Subheader&gt;Upgrade the runtime using the UpgradeKey module&lt;/Header.Subheader&gt;
          &lt;/Header.Content&gt;
        &lt;/Header&gt;
        &lt;div style={{ paddingBottom: '1em' }}&gt;&lt;/div&gt;
        &lt;FileUploadBond bond={this.runtime} content='Select Runtime' /&gt;
        &lt;TransactButton
          content="Upgrade"
          icon='warning'
          tx={{
            sender: runtime.sudo
              ? runtime.sudo.key
              : runtime.upgrade_key.key,
            call: calls.sudo
              ? calls.sudo.sudo(calls.consensus.setCode(this.runtime))
              : calls.upgrade_key.upgrade(this.runtime)
          }}
        /&gt;
      &lt;/Segment&gt;
    } /&gt;
  }
}
</code></pre>
<p>We can use this as a template for how we should add our game's UI. At the end of the file, add the following code:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoSegment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>()
    <span class="hljs-keyword">this</span>.player = <span class="hljs-keyword">new</span> Bond
  }

  render() {
    <span class="hljs-keyword">return</span> &lt;Segment style={{ margin: '1em' }} padded&gt;
      &lt;Header as='h2'&gt;
        &lt;Icon name='game' /&gt;
        &lt;Header.Content&gt;
          Play the game
          &lt;Header.Subheader&gt;Play the game here!&lt;/Header.Subheader&gt;
        &lt;/Header.Content&gt;
      &lt;/Header&gt;
      &lt;div style={{ paddingBottom: '1em' }}&gt;
        &lt;div style={{ fontSize: 'small' }}&gt;player&lt;/div&gt;
        &lt;SignerBond bond={this.player} /&gt;
        &lt;If condition={this.player.ready()} then={&lt;span&gt;
          &lt;Label&gt;Balance
            &lt;Label.Detail&gt;
              &lt;Pretty value={runtime.balances.balance(this.player)} /&gt;
            &lt;/Label.Detail&gt;
          &lt;/Label&gt;
        &lt;/span&gt;} /&gt;
      &lt;/div&gt;
      &lt;TransactButton
        content="Play"
        icon='game'
        tx={{
          sender: this.player,
          call: calls.demo.play()
        }}
      /&gt;
      &lt;Label&gt;Pot Balance
        &lt;Label.Detail&gt;
          &lt;Pretty value={runtime.demo.pot} /&gt;
        &lt;/Label.Detail&gt;
      &lt;/Label&gt;
    &lt;/Segment&gt;
  }
}
</code></pre>
<p>Beyond the updated text, you can see we are accessing a new <code>this.player</code> bond, which represents the user context playing the game.</p>
<p>Using this, we can get details like the user's balance:</p>
<pre><code class="hljs css language-javascript">runtime.balances.balance(<span class="hljs-keyword">this</span>.player)
</code></pre>
<p>And submit transactions on behalf of this user:</p>
<pre><code class="hljs css language-javascript">tx={{
  <span class="hljs-attr">sender</span>: <span class="hljs-keyword">this</span>.player,
  <span class="hljs-attr">call</span>: calls.demo.play()
}}
</code></pre>
<p>Also notice that we are able to dynamically show content like the current balance of the pot in a similar way to how we retrieved it in the developer console:</p>
<pre><code class="hljs css language-javascript">&lt;Label&gt;Pot Balance
  &lt;Label.Detail&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Pretty</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{runtime.demo.pot}/</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Label.Detail</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span></span>
</code></pre>
<p>The only thing left for us to do, is to add this component into our <code>App</code> class at the top of the file:</p>
<pre><code class="hljs css language-javascript">readyRender() {
  <span class="hljs-keyword">return</span> (&lt;div&gt;
    &lt;Heading /&gt;
    &lt;WalletSegment /&gt;
    &lt;Divider hidden /&gt;
    &lt;AddressBookSegment /&gt;
    &lt;Divider hidden /&gt;
    &lt;FundingSegment /&gt;
    &lt;Divider hidden /&gt;
    &lt;UpgradeSegment /&gt;
    &lt;Divider hidden /&gt;
    &lt;PokeSegment /&gt;
    &lt;Divider hidden /&gt;
    &lt;TransactionsSegment /&gt;
    &lt;Divider hidden /&gt;
    &lt;DemoSegment /&gt;      // Add this line
  &lt;/div&gt;)
}
</code></pre>
<p>If you save your changes and reload the page, you should see your new UI! You can now try playing the game with the <code>Default</code> user:</p>
<p><img src="https://i.imgur.com/sIspIKE.png" alt="Player losing the game"></p>
<p>Here you can see the player lost the game, which means that their 1000 units got added to the pot, and an additional 1 unit transaction fee was taken from their balance.</p>
<p>If we try a few more times, eventually the player will win the game, and the pot will be reset back to its starting amount for the next player:</p>
<p><img src="https://i.imgur.com/kqQIF3p.png" alt="Player winning the game"></p>
<h2><a class="anchor" aria-hidden="true" id="final-notes"></a><a href="#final-notes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Final Notes</h2>
<p>That's all folks! While you can't actually make a profit playing this game, hopefully you see just how simple Substrate can make it to develop your next blockchain.</p>
<p>In summary, we showed you how to:</p>
<ul>
<li>Download and install <code>substrate</code> to your machine in a single command</li>
<li>Set up a fresh <code>substrate-node-template</code> and <code>substrate-ui</code> so that you can start hacking right away</li>
<li>Program a new runtime for your blockchain</li>
<li>Upgrade your runtime, in real-time and without forking, via the <code>substrate-ui</code></li>
<li>Update the <code>substrate-ui</code> to reflect your new runtime features and functionality</li>
</ul>
<p>Substrate is a rapidly developing technology, and we would love to get your feedback, answer questions, and learn more about what you want to build!</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/tutorials/building-a-token-curated-registry-dappchain"><span class="arrow-prev">← </span><span class="function-name-prevnext">Building a Token Curated Registry DAppChain</span></a><a class="docs-next button" href="/docs/en/tutorials/deploying-a-smart-contract-on-a-substrate-node-chain"><span>Deploying a Smart Contract on a Substrate Node Chain</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#launch-a-blockchain">Launch a Blockchain</a></li><li><a href="#step-2-add-alice-to-your-network">Step 2: Add Alice to your network</a></li><li><a href="#step-3-create-a-new-runtime-module">Step 3: Create a new runtime module</a></li><li><a href="#step-4-integrate-our-new-module-into-our-runtime">Step 4: Integrate our new module into our runtime</a></li><li><a href="#step-5-upgrade-our-chain">Step 5: Upgrade our chain</a></li><li><a href="#step-6-interacting-with-our-new-module">Step 6: Interacting with our new module</a></li><li><a href="#step-7-updating-our-substrate-ui">Step 7: Updating our Substrate UI</a></li><li><a href="#final-notes">Final Notes</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/en/who">Getting Started</a><a href="/en/tutorials">Tutorials</a><a href="https://crates.parity.io">Reference Docs</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/paritytech/substrate">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Parity Technologies</section></footer></div></body></html>