<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Deploying a Smart Contract on a Substrate Node Chain · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;This document will walk you through steps used in the demo that &lt;a href=&quot;https://youtu.be/26ucTSSaqog?t=5298&quot;&gt;Sergei Shulepov and Dr Gavin Wood presented at the 2018 Dotcon-0 during the Web3 Summit&lt;/a&gt;, showing off how you can create a Substrate Node, integrate the Substrate SRML &#x27;Contracts&#x27; Module into the Substrate Node&#x27;s Runtime, and then deploy a WASM-compiled Rust Smart Contract to the Substrate Node in less than 30 min.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Deploying a Smart Contract on a Substrate Node Chain · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="&lt;p&gt;This document will walk you through steps used in the demo that &lt;a href=&quot;https://youtu.be/26ucTSSaqog?t=5298&quot;&gt;Sergei Shulepov and Dr Gavin Wood presented at the 2018 Dotcon-0 during the Web3 Summit&lt;/a&gt;, showing off how you can create a Substrate Node, integrate the Substrate SRML &#x27;Contracts&#x27; Module into the Substrate Node&#x27;s Runtime, and then deploy a WASM-compiled Rust Smart Contract to the Substrate Node in less than 30 min.&lt;/p&gt;
"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/Substrate-logo.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/Substrate-logo.svg"/><link rel="shortcut icon" href="/img/Substrate-logo.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/quickstart/getting-started" target="_self">Docs</a></li><li class=""><a href="/en/tutorials" target="_self">Tutorials</a></li><li class=""><a href="https://www.parity.io/blog/" target="_self">Blog</a></li><li class=""><a href="/community/support" target="_self">Community</a></li><li class=""><a href="https://github.com/substrate-developer-hub/" target="_self">GitHub</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/zh-CN/tutorials/deploying-a-smart-contract-on-a-substrate-node-chain">中文</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Tutorials</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Quick Start<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/quickstart/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/en/quickstart/installing-substrate">Installing Substrate</a></li><li class="navListItem"><a class="navItem" href="/docs/en/quickstart/using-the-substrate-node-and-module-setup-scripts">Using the Substrate node and module setup scripts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Runtime<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Macros</h4><ul><li class="navListItem"><a class="navItem" href="/docs/en/runtime/macros/construct_runtime">Constructing a Runtime!</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/macros/decl_module">Declaring a Module!</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/macros/decl_storage">runtime/macros/decl_storage</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Types</h4><ul><li class="navListItem"><a class="navItem" href="/docs/en/runtime/types/call-enum">Call Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/types/event-enum">Event Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/types/genesisconfig-struct">GenesisConfig Struct</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/en/runtime/architecture-of-a-runtime">Architecture of a Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/runtime-and-api">Runtime and API</a></li><li class="navListItem"><a class="navItem" href="/docs/en/runtime/substrate-runtime-module-library">Substrate Runtime Module Library</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Substrate Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/overview/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/low-level-data-format">Low-level Data Format</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/substrate-bonds">overview/substrate-bonds</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/telemetry">Telemetry</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/transaction-lifecycle">Transaction Lifecycle</a></li><li class="navListItem"><a class="navItem" href="/docs/en/overview/versioning">Versioning</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/building-a-token-curated-registry-dappchain">Building a Token Curated Registry DAppChain</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/creating-a-custom-substrate-chain">Creating a Custom Substrate chain</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/tutorials/deploying-a-smart-contract-on-a-substrate-node-chain">Deploying a Smart Contract on a Substrate Node Chain</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/start-a-private-network-with-substrate">Start a Private Network with Substrate</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/keys--seeds--and-the--subkey--tool">Keys, Seeds, and the `subkey` Tool</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/governance--public--mechanism-with-a-substrate-node-chain">Governance &quot;Public&quot; Mechanism with a Substrate Node Chain</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/migrating-storage-to-a-new-substrate-node-s-runtime">Migrating Storage to a new Substrate Node&#x27;s Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/substrate-collectables-workshop">tutorials/substrate-collectables-workshop</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/substrate-runtime-recipes">Substrate Runtime Recipes</a></li><li class="navListItem"><a class="navItem" href="/docs/en/tutorials/validator-nodes-and-nominators-on-substrate-chains">Validator Nodes and Nominators on Substrate chains</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Deploying a Smart Contract on a Substrate Node Chain</h1></header><article><div><span><p>This document will walk you through steps used in the demo that <a href="https://youtu.be/26ucTSSaqog?t=5298">Sergei Shulepov and Dr Gavin Wood presented at the 2018 Dotcon-0 during the Web3 Summit</a>, showing off how you can create a Substrate Node, integrate the Substrate SRML 'Contracts' Module into the Substrate Node's Runtime, and then deploy a WASM-compiled Rust Smart Contract to the Substrate Node in less than 30 min.</p>
<p>In addition, we will show how to use the <a href="https://polkadot.js.org/apps/next/">Polkadot-JS Apps</a> UI to simplify your workflow interacting with Substrate PoC-3, and how to use the <a href="https://polkadot.js.org/api/">Polkadot-JS API</a> to learn to author your own custom Dapps that interact with Substrate using JavaScript with a choice of using Promises or RxJS.</p>
<p>This tutorial will be written for a Mac OS X machine, and may require some tweaks to get it working on other operating systems.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<h3><a class="anchor" aria-hidden="true" id="setup-directories-for-code"></a><a href="#setup-directories-for-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Directories for Code</h3>
<p>We'll be using code from the following Parity Github repositories:</p>
<ul>
<li><a href="https://github.com/paritytech">https://github.com/paritytech</a></li>
<li><a href="https://github.com/polkadot-js">https://github.com/polkadot-js</a></li>
</ul>
<p>So we'll start by creating subdirectories to organise the code that we'll be downloading from them. We'll namespace them to match the Github usernames:</p>
<pre><code class="hljs css language-shell">mkdir -p ~/code/paritytech ~/code/polkadot-js
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="setup-substrate-node-and-substrate-ui"></a><a href="#setup-substrate-node-and-substrate-ui" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Substrate Node and Substrate UI</h3>
<p>Run the following command to install Substrate.</p>
<pre><code class="hljs css language-shell">cd ~/code/paritytech;
curl https://getsubstrate.io -sSf | sh
</code></pre>
<p>You will also need to set up a few more repositories into your working folder which were used in the demo:</p>
<ul>
<li><a href="https://github.com/paritytech/substrate-node-template">Substrate Node Template</a></li>
<li><a href="https://github.com/paritytech/substrate-ui">Substrate UI</a></li>
<li><a href="https://github.com/polkadot-js/apps">Polkadot-JS Apps</a></li>
</ul>
<p>You can do that with some <a href="https://github.com/paritytech/substrate-up">script aliases</a> that were loaded on your machine:</p>
<pre><code class="hljs css language-shell">cd ~/code/paritytech
substrate-node-new my-substrate-node-template-1 my-name
substrate-ui-new substrate my-substrate-node-template-1
</code></pre>
<p>This will create folders called 'my-substrate-node-template-1' and 'substrate-ui' within directory ~/code/paritytech, with the corresponding repositories cloned in them. You can of course rename your projects in these commands, but for the sake of the clarity, we will continue with these folder names.</p>
<h4><a class="anchor" aria-hidden="true" id="setup-polkadot-js-apps"></a><a href="#setup-polkadot-js-apps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Polkadot-JS Apps</h4>
<p>We'll also run a couple of other script aliases to install necessary dependencies (Xcode Command Line Tools, Homebrew, Homebrew Cask, RBEnv, Ruby, NVM and Node.js latest LTS, Yarn,) and create a folder called <code>apps</code> within directory ~/code/polkadot-js, containing a clone of the Polkadot-JS Apps repository with a branch that supports PoC-4:</p>
<pre><code class="hljs css language-shell">cd ~/code/polkadot-js
polkadot-js-dependencies
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="view-and-run-the-rust-program-demo"></a><a href="#view-and-run-the-rust-program-demo" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>View and Run the Rust Program Demo</h3>
<h4><a class="anchor" aria-hidden="true" id="view-rust-code-easy"></a><a href="#view-rust-code-easy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>View Rust Code (Easy)</h4>
<p>We've bundled all the code samples from this guide in the following <a href="https://github.com/paritytech/substrate/compare/deploy-smart-contract-adder?expand=1">Substrate branch 'deploy-smart-contract-adder'</a> that you may view in the browser.</p>
<h4><a class="anchor" aria-hidden="true" id="run-rust-program-advanced-a-name-run-rust-program-a"></a><a href="#run-rust-program-advanced-a-name-run-rust-program-a" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run Rust Program (Advanced) <a name="run-rust-program"></a></h4>
<p>Once Substrate is installed. Switch to branch 'deploy-smart-contract-adder', run relevant Git commands that you are familiar with to rebase or merge the latest changes in the 'master' branch into 'deploy-smart-contract-adder'. We'll run yet another script alias 'substrate-dependencies' to install or update necessary Substrate dependencies, and then build and run the program:</p>
<pre><code class="hljs css language-shell">cd ~/code/paritytech
git clone https://github.com/paritytech/substrate
cd substrate
git fetch origin deploy-smart-contract-adder:deploy-smart-contract-adder
git checkout master
git pull --rebase origin master
git checkout deploy-smart-contract-adder
git merge master
substrate-dependencies
./scripts/build.sh
cargo build
cargo run -p deploy-smart-contract-adder
</code></pre>
<p><strong>FIXME</strong> - the above rebase/merge from 'master' branch gets Substrate version 0.1.0, whereas using the shell script retrieves version 0.9.0</p>
<h2><a class="anchor" aria-hidden="true" id="step-1-integrate-substrate-srml-contracts-module-into-substrate-node-runtime"></a><a href="#step-1-integrate-substrate-srml-contracts-module-into-substrate-node-runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 1: Integrate Substrate SRML 'Contracts' Module into Substrate Node Runtime</h2>
<p>We want to build upon 'smart contract' mechanism dependencies, so we've gone for the most convenient option of cloning the <a href="https://github.com/paritytech/substrate">ParityTech Substrate</a> repo, which contains <strong>Substrate Core</strong> with the <strong>Substrate (&lt;&lt;glossary:SRML&gt;&gt;)</strong>, including a 'Contracts' Module.
<img src="https://files.readme.io/d9889e8-Screen_Shot_2018-11-18_at_15.31.36.png" alt="Source: https://youtu.be/0IoUZdDi5Is?t=1470"></p>
<p>The <a href="https://github.com/paritytech/substrate/blob/master/node-template">Substrate Node Template</a> however only includes a minimal Substrate Node chain, so if we had chosen to build upon that instead we'd have had to plugin the 'Contracts' Module manually.</p>
<p><img src="https://files.readme.io/ff3a66e-53b8dc8-Screen_Shot_2018-11-18_at_15.31.20.png" alt="Source: https://youtu.be/0IoUZdDi5Is?t=1377"></p>
<h2><a class="anchor" aria-hidden="true" id="step-2-launch-a-substrate-node-blockchain"></a><a href="#step-2-launch-a-substrate-node-blockchain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 2: Launch a Substrate Node Blockchain</h2>
<p>If you have set up everything correctly, you can now start a Substrate dev chain! In directory 'my-substrate-node-template-1' run the following and it will be published on <a href="https://telemetry.polkadot.io">Telemetry</a>:</p>
<pre><code class="hljs css language-shell">cd ~/code/paritytech/my-substrate-node-template-1
./target/release/my-substrate-node-template-1 \\
  --dev \\
  --telemetry-url ws://telemetry.polkadot.io:1024
</code></pre>
<blockquote>
<p>If you run into an error like <code>Error: UnknownBlock: Unknown block Hash(...)</code>, you will need to purge the chain files from disk, with either of the following commands: <code>cargo run -- --dev purge-chain --dev</code> or <code>rm -rf ~/Library/Application\ Support/Substrate/chains/development/</code></p>
</blockquote>
<pre><code class="hljs css language-shell">cargo run -- --dev purge-chain --dev
</code></pre>
<p>If everything is working it should start producing blocks, as shown below:
![Producing Blocks](<a href="https://files.readme.io/4876514-Screen_Shot_2018-11-16_at_11.28.02.png]">https://files.readme.io/4876514-Screen_Shot_2018-11-16_at_11.28.02.png]</a></p>
<blockquote>
<p>To stop running your Substrate node, you can press CTRL+C</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="step-3-launch-ui-of-polkadot-js-apps"></a><a href="#step-3-launch-ui-of-polkadot-js-apps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 3: Launch UI of Polkadot-JS Apps</h2>
<p>To interact with the Substrate Node, we'll start the UI of Polkadot JS Apps.</p>
<pre><code class="hljs css language-shell">cd ~/code/polkadot-js/apps;
yarn run start
</code></pre>
<p>Open your browser to <a href="http://localhost:3000">http://localhost:3000</a>.</p>
<p>Go to the 'Settings' menu item. Select option 'Local Node (127.0.0.1:9944)', then click 'Save &amp; Reload'.
<img src="https://files.readme.io/d75fe2b-Screen_Shot_2018-11-14_at_13.59.34.png&quot;" alt="Configure Local Node is Polkadot-js Apps"></p>
<p>It will connect to the local Substrate Node that you're running and update the UI with additional menu items, as shown below:
<img src="https://files.readme.io/e2836dc-Screen_Shot_2018-11-16_at_11.02.31.png" alt="More apps appearing"></p>
<h2><a class="anchor" aria-hidden="true" id="step-4-obtain-block-hash-of-genesis-block-using-json-rpc"></a><a href="#step-4-obtain-block-hash-of-genesis-block-using-json-rpc" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 4: Obtain Block Hash of Genesis Block using JSON-RPC</h2>
<h3><a class="anchor" aria-hidden="true" id="option-1-interact-with-polkadot-js-apps"></a><a href="#option-1-interact-with-polkadot-js-apps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Option 1: Interact with Polkadot-JS Apps</h3>
<p>Let's go to the 'Chain state' menu item and create JSON-RPC calls to the Substrate Node and display the response below. Select 'system' and 'blockHash(BlockNumber): Hash' from the selection boxes, as shown below, and enter value '0' for the 'BlockNumber' label. Lastly click the blue '+' button, and the response will display below. If you click the red 'x' button it removes the response.</p>
<ul>
<li><strong>FIXME</strong> - update the screenshot below when running local node, after this issue resolved <a href="https://github.com/polkadot-js/apps/issues/451">https://github.com/polkadot-js/apps/issues/451</a>
<img src="https://files.readme.io/e6dcf33-Screen_Shot_2018-11-14_at_14.15.50.png" alt="running local node"></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="option-2-interact-using-curl"></a><a href="#option-2-interact-using-curl" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Option 2: Interact using cURL</h3>
<p>Alternatively we can fetch the block hash of the genesis block in the Substrate Node by using cURL to perform a JSON-RPC call that contains a JSON-RPC request object with members including method <code>state_getBlockHash</code> and params <code>[0]</code> (the genesis block).</p>
<pre><code class="hljs css language-shell">curl -H 'Content-Type: application/json' \\
     -d '{ "jsonrpc": "2.0", "method":"chain_getBlockHash", "params":[0], "id": 1 }' \\
     -vv http://127.0.0.1:9933/
</code></pre>
<p>We'll receive a <a href="https://www.jsonrpc.org/specification#response_object">JSON-RPC response object</a> as follows, where the 'result' member contains the block hash:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"jsonrpc"</span>:<span class="hljs-string">"2.0"</span>,
  <span class="hljs-attr">"result"</span>:<span class="hljs-string">"0x0000fcb6a13183bf24669dc6d66ad80eaf20ee17e3712ba79b0285c2b42adc79"</span>,
  <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="step-5-about-the-smart-contract-adder-rust-program"></a><a href="#step-5-about-the-smart-contract-adder-rust-program" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 5: About the Smart Contract 'Adder' Rust program</h2>
<p>The Smart Contract 'Adder' is a basic counter that has two actions that we can execute:</p>
<ul>
<li><code>Inc(u32)</code> function that increments the counter by the value of the parameter provided;</li>
<li><code>Get</code> function that returns the current counter value</li>
</ul>
<p>When the contract is executed, we read the input data, decode it into an action using the <code>Action</code> enumeration, then depending on the action we execute it as follows:</p>
<ul>
<li><p><code>Action::Inc(by)</code>: We query the extrinsic storage using the counter key, then decode and return the resultant u32 value (if any), or return a value of 0 if no value exists yet. We then increment the value by the u32 <code>by</code> value that we specified. Lastly we encode the incremented value as u32 and set the updated extrinsic counter key value in storage.</p></li>
<li><p><code>Action::Get</code>: We simply query the extrinsics storage using the counter key and return that value.</p></li>
<li><p>Extracted code snippets from the <a href="https://github.com/pepyakin/substrate-contracts-adder/blob/master/src/lib.rs">Smart Contract 'Adder'</a> are shown below:</p></li>
</ul>
<pre><code class="hljs css language-rust">...

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Action</span></span> {
    Inc(<span class="hljs-built_in">u32</span>),
    Get,
}

<span class="hljs-keyword">static</span> COUNTER_KEY: ext::Key = ext::Key([<span class="hljs-number">1</span>; <span class="hljs-number">32</span>]);

...

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">call</span></span>() {
    <span class="hljs-keyword">let</span> input = ext::input();
    <span class="hljs-keyword">let</span> action = Action::decode(&amp;<span class="hljs-keyword">mut</span> &amp;input[..]).unwrap();

    <span class="hljs-keyword">match</span> action {
        Action::Inc(by) =&gt; {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> counter = ext::get_storage(&amp;COUNTER_KEY).and_then(|v| <span class="hljs-built_in">u32</span>::decode(&amp;<span class="hljs-keyword">mut</span> &amp;v[..])).unwrap_or(<span class="hljs-number">0</span>);
            counter += by;
            ext::set_storage(&amp;COUNTER_KEY, <span class="hljs-literal">Some</span>(&amp;<span class="hljs-built_in">u32</span>::encode(&amp;counter)));
        }
        Action::Get =&gt; {
            <span class="hljs-keyword">let</span> raw_counter = ext::get_storage(&amp;COUNTER_KEY).unwrap_or(<span class="hljs-built_in">vec!</span>[]);
            ext::return_(&amp;raw_counter);
        }
    }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="step-6-generate-wasm-file-from-smart-contract-adder-rust-program"></a><a href="#step-6-generate-wasm-file-from-smart-contract-adder-rust-program" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 6: Generate WASM file from Smart Contract 'Adder' Rust program</h2>
<p>Let's clone the 'Adder' Smart Contract Rust library, and compile its Rust code into a WASM file using the provided <code>./build.sh</code> Shell script, which runs a <code>wasm-build</code> command from the <a href="https://github.com/paritytech/wasm-utils">wasm-utils</a> repository. The generated WASM file will be located in <code>~/substrate-contracts-adder/target/wasm32-unknown-unknown/release/substrate_contracts_adder.wasm</code></p>
<pre><code class="hljs css language-shell">git clone https://github.com/pepyakin/substrate-contracts-adder
cd substrate-contracts-adder
./build.sh
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="step-7-create-extrinsic-and-deploy-smart-contract-adder-to-substrate-node"></a><a href="#step-7-create-extrinsic-and-deploy-smart-contract-adder-to-substrate-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 7: Create Extrinsic and Deploy Smart Contract 'Adder' to Substrate Node</h2>
<h3><a class="anchor" aria-hidden="true" id="option-1-interact-using-ui-of-polkadot-js-apps-easy"></a><a href="#option-1-interact-using-ui-of-polkadot-js-apps-easy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Option 1: Interact using UI of Polkadot-JS Apps (Easy)</h3>
<h4><a class="anchor" aria-hidden="true" id="load-the-in-built-alice-account-from-substrate"></a><a href="#load-the-in-built-alice-account-from-substrate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Load the in-built Alice account from Substrate</h4>
<p>If you're running the Substrate Node on your local machine then the in-built accounts including Alice will be pre-loaded, as shown below in the 'Accounts' menu item:
<img src="https://files.readme.io/beb78b0-Screen_Shot_2018-11-16_at_14.34.23.png" alt="Preloaded Accounts"></p>
<h4><a class="anchor" aria-hidden="true" id="submit-an-extrinsic-with-nonce-0-to-deploy-smart-contract-adder-to-the-substrate-node"></a><a href="#submit-an-extrinsic-with-nonce-0-to-deploy-smart-contract-adder-to-the-substrate-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submit an Extrinsic with Nonce 0 to Deploy Smart Contract 'Adder' to the Substrate Node</h4>
<p>We'll perform the following actions, as shown in the screenshot below:</p>
<ul>
<li>Navigate to Polkadot-JS Apps Extrinsics menu item at <a href="https://localhost:3000/#/extrinsics">https://localhost:3000/#/extrinsics</a>.</li>
<li>Select under label 'from selected account': <code>ALICE</code> Alice's account (to send the extrinsic since she has sufficient available balance to cover the fees and any DOTs to be sent)</li>
<li>Select under label 'from extrinsic section': <code>contract</code></li>
<li>Select under label 'submit the following extrinsic': <code>create(value, gas_limit, init_code, data)</code></li>
<li>Enter under label 'value: Balance': <code>1001</code></li>
<li>Enter under label 'gas_limit: Gas': <code>9000000</code></li>
<li>Enter under label 'init_code: Bytes': Click the icon to upload a .wasm format file of the Smart Contract 'Adder' that we compiled to WASM from Rust. It should be located at: ~/code/src/pepyakin/substrate-contracts-adder/target/wasm32-unknown-unknown/release/substrate_contracts_adder.wasm
This is equivalent to copy/pasting the hex value <code>0x____</code> of the loaded WASM contract obtained later in the section <a href="#write-rust-program">&quot;Option 2: Write Rust Program&quot;</a></li>
<li>Enter under label 'data: Bytes': ???</li>
<li>Enter under label 'with an index': <code>0</code></li>
</ul>
<p>Click 'Submit Transaction' to open a modal.
Click 'Sign &amp; Submit' in the modal to add the extrinsic into the 'pending' extrinsics queue.</p>
<ul>
<li><strong>FIXME</strong> - update the screenshot below when running local node, after this issue resolved <a href="https://github.com/polkadot-js/apps/issues/451">https://github.com/polkadot-js/apps/issues/451</a>
<img src="https://files.readme.io/dce4586-Screen_Shot_2018-11-15_at_01.33.05.png" alt="https://files.readme.io/dce4586-Screen_Shot_2018-11-15_at_01.33.05.png"></li>
</ul>
<blockquote>
<p><strong>Pending Extrinsics</strong></p>
<p>If you're quick enough at querying the 'pending' extrinsics (after clicking Sign &amp; Submit) then you'll see the extrinsic go in and out of the 'pending' extrinsics queue in the response. We'll use the 'Raw RPC' menu item at <a href="https://localhost:3000/#/rpc">https://localhost:3000/#/rpc</a> in the section &quot;author &gt; pendingExtrinsics&quot; to make the query.</p>
</blockquote>
<p><strong>FIXME</strong> - how do we determine the contract address of an extrinsic to create a contract that we submit in the Extrinsics or the Raw RPC sections of the UI?
<strong>FIXME</strong> - how do we determine the storage key of a contract address from an extrinsic that we submit in the Extrinsics or the Raw RPC sections of the UI? we need this to verify the extrinsics are submitted</p>
<h4><a class="anchor" aria-hidden="true" id="submit-an-extrinsic-with-nonce-1-to-increment-storage-by-7-in-the-smart-contract-adder"></a><a href="#submit-an-extrinsic-with-nonce-1-to-increment-storage-by-7-in-the-smart-contract-adder" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submit an Extrinsic with Nonce 1 to Increment storage by 7 in the Smart Contract 'Adder'</h4>
<p><strong>FIXME</strong> - why is there a destination address for a <code>call</code>? isn't the contract in storage?
<strong>FIXME</strong> - what to paste into the input field for the <code>data: Bytes</code> value?</p>
<ul>
<li>Select under label 'from selected account': <code>ALICE</code> Alice's account (to send the extrinsic since she has sufficient available balance to cover the fees and any DOTs to be sent)</li>
<li>Select under label 'from extrinsic section': <code>contract</code></li>
<li>Select under label 'submit the following extrinsic': <code>call(dest, value, gas_limit, data)</code></li>
<li>Select under label 'dest: AccountId': ???</li>
<li>Enter under label 'value: Balance': <code>1001</code></li>
<li>Enter under label 'gas_limit: Gas': <code>9000000</code></li>
<li>Enter under label 'data: Bytes': ??? <code>[0x00, 0x07, 0x00, 0x00, 0x00]</code></li>
<li>Enter under label 'with an index': <code>1</code></li>
</ul>
<p>Click 'Submit Transaction' to open a modal.
Click 'Sign &amp; Submit' in the modal to add the extrinsic into the 'pending' extrinsics queue.</p>
<ul>
<li><strong>FIXME</strong> - update the screenshot below when running local node, after this issue resolved <a href="https://github.com/polkadot-js/apps/issues/451">https://github.com/polkadot-js/apps/issues/451</a>
<img src="https://files.readme.io/3d96754-Screen_Shot_2018-11-15_at_01.34.00.png" alt="todo"></li>
</ul>
<p>Show the extrinsic in the 'pending' extrinsics queue using the Polkadot-JS Apps 'Raw RPC' menu item of the UI at <a href="https://localhost:3000/#/rpc">https://localhost:3000/#/rpc</a> in the section &quot;author &gt; pendingExtrinsics&quot;</p>
<p>Once again we'll show the extrinsic go in and out of the 'pending' extrinsics queue in the response using the 'Raw RPC' menu item at <a href="https://localhost:3000/#/rpc">https://localhost:3000/#/rpc</a> in the section &quot;author &gt; pendingExtrinsics&quot; to make the query.</p>
<h3><a class="anchor" aria-hidden="true" id="option-2-write-rust-program-advanced-a-name-write-rust-program-a"></a><a href="#option-2-write-rust-program-advanced-a-name-write-rust-program-a" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Option 2: Write Rust Program (Advanced) <a name="write-rust-program"></a></h3>
<p>We've provided the following guide to demonstrate an alternate approach, without using a UI, that will give you the opportunity to write a Rust program that uses Substrate. We'll use it to:</p>
<ul>
<li>Convert a given WASM Smart Contract into Hex format, which we could then use to submit an extrinsic.
<ul>
<li>Note: Optionally paste this hex value as the value of <code>init_code: Bytes</code> when creating a contract extrinsic using the Polkadot-JS Apps Extrinsics menu item at <a href="https://localhost:3000/#/extrinsics">https://localhost:3000/#/extrinsics</a></li>
</ul></li>
<li>Load the in-built Alice account from Substrate into a Rust variable</li>
<li>Print an Extrinsic with Nonce 0 in encoded form, where Alice would submit Smart Contract 'Adder' to the Substrate Node.
<ul>
<li>Note: We later provide this value as the value of the <code>params</code> member of a JSON-RPC call that we make to submit the contract using cURL. Previously we used the Polkadot-JS Apps 'Chain State' menu item at <a href="https://localhost:3000/#/chainstate">https://localhost:3000/#/chainstate</a></li>
</ul></li>
<li>Pre-Determine the Contract Address of a Substrate Node in the Runtime that the Smart Contract 'Adder' would be deployed to by Alice once Submitted</li>
<li>Print an Extrinsic with Nonce 1 of a Call to Increment storage by 7 in the Smart Contract 'Adder' at the pre-determined Contract Address using the encoded form of the Extrinsic</li>
<li>Print the Pre-Determined Storage Key of the Pre-Determined Smart Contract 'Adder' Address in Substrate Database Storage.
<ul>
<li>Note: Optionally determine this value using the Polkadot-JS Apps 'Raw RPC' menu item at <a href="https://localhost:3000/#/rpc">https://localhost:3000/#/rpc</a> in the section 'state &gt; getStorage(key)'</li>
</ul></li>
<li>Submit the Extrinsic with Nonce 0 using JSON-RPC and cURL to deploy Smart Contract 'Adder' to a Substrate Node.
<ul>
<li>Note: Optionally use the Polkadot-JS Apps 'Raw RPC' menu item at <a href="https://localhost:3000/#/rpc">https://localhost:3000/#/rpc</a> in the section &quot;author &gt; submitExtrinsic&quot;</li>
</ul></li>
<li>Check Pending Extrinsics until Extrinsic with Nonce 0 is Submitted.
<ul>
<li>Note: Optionally use the Polkadot-JS Apps 'Raw RPC' menu item at <a href="https://localhost:3000/#/rpc">https://localhost:3000/#/rpc</a> in the section &quot;author &gt; pendingExtrinsics&quot;</li>
</ul></li>
<li>Verify Extrinsic with Nonce 0 was Submitted</li>
<li>Verify the Current Nonce of an Account ID
<ul>
<li>Note: Optionally use the Polkadot-JS Apps 'Chain State' menu item at <a href="https://localhost:3000/#/chainstate">https://localhost:3000/#/chainstate</a> in the section &quot;state &gt; accountNonce&quot;</li>
</ul></li>
<li>Submit the Extrinsic with Nonce 1 by providing JSON-RPC method <code>author_submitExtrinsic</code> and params <code>[&quot;&lt;INSERT_EXTRINSIC_NONCE_1_HASH&gt;&quot;]</code> using cURL</li>
<li>Check Pending Extrinsics until Extrinsic with Nonce 1 is Submitted</li>
<li>Verify Extrinsic with Nonce 1 was Submitted</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="convert-wasm-smart-contract-to-hex-using-genesis-block-hash"></a><a href="#convert-wasm-smart-contract-to-hex-using-genesis-block-hash" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Convert WASM Smart Contract to Hex using Genesis Block Hash</h4>
<p>Before we start creating a Rust program that uses Substrate, we'll first need to access to the full Substrate repository on Github to access relevant Substrate dependencies. Unfortunately we can't use the simplified Substrate Node code in directory 'my-substrate-node-template-1' that we generated with the shell script <code>substrate-node-new</code>.</p>
<ul>
<li>FIXME - is there really no way for us to use the Substrate codebase generated with <code>substrate-node-new</code>?</li>
</ul>
<p>Let's follow similar steps to <a href="#run-rust-program">&quot;Option 2: Run Rust Program (Advanced)&quot;</a>, where we viewed the complete solution, but here we just clone the 'master' branch, checkout a new branch named 'deploy-smart-contract-adder' where we'll create our new Rust program, and build Substrate.</p>
<pre><code class="hljs css language-shell">cd ~/code/paritytech
git clone https://github.com/paritytech/substrate
cd substrate
git fetch origin master
git checkout -b deploy-smart-contract-adder
substrate-dependencies
./scripts/build.sh
cargo build
</code></pre>
<p>We're ready to <a href="https://doc.rust-lang.org/cargo/guide/creating-a-new-project.html">create a new Rust program</a>.</p>
<pre><code class="hljs css language-shell">cd ~/code/paritytech/substrate
cargo new examples/deploy-smart-contract-adder --bin
</code></pre>
<p>Add dependencies to Cargo.toml</p>
<pre><code class="hljs css language-toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"deploy-smart-contract-adder"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">authors</span> = [<span class="hljs-string">"Parity Technologies &lt;admin@parity.io&gt;"</span>]
<span class="hljs-attr">description</span> = <span class="hljs-string">"Substrate Deploy Smart Contract."</span>
<span class="hljs-section">
[dependencies]</span>
<span class="hljs-attr">hex-literal</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">hex</span> = <span class="hljs-string">"0.3"</span>
<span class="hljs-attr">substrate-primitives</span> = { path = <span class="hljs-string">"../../core/primitives"</span> }
</code></pre>
<p>We'll create the encoded form of an extrinsic (blob of data) to be sent from Alice that contains instructions to deploy a certain WASM smart contract.</p>
<p>Update main.rs (executable file of the program) <code>~/code/paritytech/substrate/examples/deploy-smart-contract-adder/src/main.rs</code>, replacing <code>&lt;INSERT_BLOCK_HASH&gt;</code> with the block hash obtained in the previous step (i.e. <code>&quot;0x0000fcb6a13183bf24669dc6d66ad80eaf20ee17e3712ba79b0285c2b42adc79&quot;</code>)</p>
<pre><code class="hljs css language-rust"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> substrate_primitives <span class="hljs-keyword">as</span> primitives;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> hex;

<span class="hljs-meta">#[macro_use]</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> hex_literal;

<span class="hljs-keyword">use</span> std::fmt::Write;
<span class="hljs-keyword">use</span> primitives::hexdisplay::HexDisplay;

<span class="hljs-comment">/// Display the hex value of the smart contract</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">show_hex_of_smart_contract</span></span>(raw_bytes: &amp;[<span class="hljs-built_in">u8</span>]) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> hex_raw_bytes = <span class="hljs-built_in">String</span>::new();
    <span class="hljs-built_in">write!</span>(hex_raw_bytes, <span class="hljs-string">"0x"</span>);
    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> raw_bytes {
        <span class="hljs-built_in">write!</span>(hex_raw_bytes, <span class="hljs-string">"{:02x}"</span>, byte);
    }
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Smart Contract 'Adder' WASM code in hex is: {}"</span>, hex_raw_bytes);
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-comment">/// Add 0x-prefix to given genesis block hash.</span>
    <span class="hljs-keyword">const</span> GENESIS_BLOCK_HASH: &amp;[<span class="hljs-built_in">u8</span>; <span class="hljs-number">32</span>] = &amp;hex!(<span class="hljs-string">"771dfd2593b2f07998e3a1ffb196f78ca583c25641a3bc844d3d6a49405acde0"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Genesis Block Hash is: 0x{}
"</span>, HexDisplay::from(GENESIS_BLOCK_HASH));

    <span class="hljs-comment">/// Load Smart Contract 'Adder' WASM code into a bytes slice</span>
    <span class="hljs-keyword">const</span> ADDER_INIT_CODE: &amp;<span class="hljs-symbol">'static</span> [<span class="hljs-built_in">u8</span>] = include_bytes!(<span class="hljs-string">"/Users/YOUR_USERNAME/code/src/pepyakin/substrate-contracts-adder/target/wasm32-unknown-unknown/release/substrate_contracts_adder.wasm"</span>);
    show_hex_of_smart_contract(&amp;ADDER_INIT_CODE);
}
</code></pre>
<p>Run the Rust program</p>
<pre><code class="hljs css language-shell">cargo run -p deploy-smart-contract-adder
</code></pre>
<p>Expect the terminal output to return a similar response to that shown below, but with different values that we'll make use of. The WASM code hex value will be much longer!</p>
<pre><code class="hljs css language-text">Genesis Block Hash is: 0x771dfd2593b2f07998e3a1ffb196f78ca583c25641a3bc844d3d6a49405acde0

Smart Contract 'Adder' WASM code in hex is: 0x0061...7079
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="load-in-built-account-alice"></a><a href="#load-in-built-account-alice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Load In-Built Account 'Alice'</h4>
<p>We'll update the Rust program to load the account key of an in-built account named Alice, since we'll be using her account to deploy the Smart Contract 'Adder' to the BBQ Birch PoC-3 chain.</p>
<p>Add additional dependencies to Cargo.toml:</p>
<pre><code class="hljs css language-toml"><span class="hljs-attr">substrate-primitives</span> = { path = <span class="hljs-string">"../../core/primitives"</span> }
<span class="hljs-attr">substrate-keyring</span> = { path = <span class="hljs-string">"../../core/keyring"</span> }
<span class="hljs-attr">node-primitives</span> = { path = <span class="hljs-string">"../../node/primitives"</span> }
</code></pre>
<p>Add these functions to main.rs</p>
<pre><code class="hljs css language-rust"><span class="hljs-comment">/// Get Alice's account public key</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">get_alice_public_key</span></span>() -&gt; AccountId {
    AccountId::from(Keyring::Alice.to_raw_public())
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    ...

    <span class="hljs-comment">/// Get Alice's account key</span>
    <span class="hljs-keyword">let</span> pair = Pair::from(Keyring::from_public(Public::from_raw(get_alice_public_key().clone().into())).unwrap());
    <span class="hljs-keyword">let</span> alice = AccountId::from(&amp;pair.public().<span class="hljs-number">0</span>[..]);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Alice's Account Key is: {:?} ({})
"</span>, alice, keyring::ed25519::Public(alice.<span class="hljs-number">0</span>).to_ss58check());
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="print-an-extrinsic-with-nonce-0-in-encoded-form-where-alice-would-deploy-smart-contract-adder-to-the-substrate-node"></a><a href="#print-an-extrinsic-with-nonce-0-in-encoded-form-where-alice-would-deploy-smart-contract-adder-to-the-substrate-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Print an Extrinsic with Nonce 0 in encoded form where Alice would deploy Smart Contract 'Adder' to the Substrate Node</h4>
<p>We'll create the encoded form of an extrinsic (blob of data) sent from Alice that contains instructions to deploy a certain WASM smart contract.</p>
<p>Add additional dependencies to Cargo.toml:</p>
<pre><code class="hljs css language-toml"><span class="hljs-attr">node-runtime</span> = { path = <span class="hljs-string">"../../node/runtime"</span> }
<span class="hljs-attr">sr-primitives</span> = { path = <span class="hljs-string">"../../core/sr-primitives"</span> }
<span class="hljs-attr">srml-balances</span> = { path = <span class="hljs-string">"../../srml/balances"</span> }
<span class="hljs-attr">srml-contract</span> = { path = <span class="hljs-string">"../../srml/contract"</span> }
</code></pre>
<p>Add the following code to to main.rs that we've explained for you below.</p>
<p>It creates an unchecked extrinsic that's signed with Alice's public key pair. It's been provided with a Nonce (index) value of <code>0</code>, assuming this will be the first extrinsic that we'll have submitted to the chain using Alice's account. We'll also provide it with a function call to <code>create</code> a contract using the Substrate runtime that has arguments including the funds to send <code>1001</code> to the contract, gas limit to allocate <code>9_000_000</code> to the extrinsic, and the bytes of the Smart Contract 'Adder' as data.</p>
<p>Note importantly that the <code>create</code> function is just an enum variant, it's not a function, so no call to create the contract is performed until we actually submit the extrinsic with a JSON-RPC call.</p>
<p>We've provided it with an era that has an indefinite (immortal) period, which is dangerous since we're using the first index. It means the transaction is not protected from replay attacks.</p>
<blockquote>
<p><strong>Transaction Eras in Substrate</strong></p>
<p>We really should be taking advantage of Substrate's <strong>Transaction Eras</strong> so that the transaction is only valid for a certain period of time, as this protects Alice's account from being subjected to malicious replay attacks on the first index if her account is deleted along with its Nonce (enumeration index), perhaps due to insufficient funds, and exposing it to a malicious user who may <a href="https://github.com/paritytech/substrate/wiki/Reclaiming-an-index">reclaim her account</a>.</p>
</blockquote>
<p><strong>FIXME</strong> - reuse to avoid duplicate code in <code>show_hex_of_extrinsic</code> and <code>show_hex_of_smart_contract</code></p>
<pre><code class="hljs css language-rust"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> node_runtime;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> sr_primitives <span class="hljs-keyword">as</span> runtime_primitives;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> srml_balances <span class="hljs-keyword">as</span> balances;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> srml_contract <span class="hljs-keyword">as</span> contract;

<span class="hljs-keyword">use</span> node_runtime::{UncheckedExtrinsic, Call, Runtime};

<span class="hljs-comment">/// Display the hex value of the extrinsic</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">show_hex_of_extrinsic</span></span>(raw_bytes: &amp;[<span class="hljs-built_in">u8</span>]) {
  <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> hex_raw_bytes = <span class="hljs-built_in">String</span>::new();
  <span class="hljs-built_in">write!</span>(hex_raw_bytes, <span class="hljs-string">"0x"</span>);
  <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> raw_bytes {
    <span class="hljs-built_in">write!</span>(hex_raw_bytes, <span class="hljs-string">"{:02x}"</span>, byte);
  }
  <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Unchecked Extrinsic with Nonce 0: {}"</span>, hex_raw_bytes);
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">print_extrinsic</span></span>(pair: &amp;Pair, genesis_hash: &amp;[<span class="hljs-built_in">u8</span>; <span class="hljs-number">32</span>], index: <span class="hljs-built_in">u64</span>, func: Call) {
  <span class="hljs-keyword">let</span> pepa = AccountId::from(&amp;pair.public().<span class="hljs-number">0</span>[..]);
  <span class="hljs-keyword">let</span> era = Era::immortal();
  <span class="hljs-keyword">let</span> payload = (index, func.clone(), era, genesis_hash);
  <span class="hljs-keyword">let</span> signature = pair.sign(&amp;payload.encode()).into();
  <span class="hljs-keyword">let</span> uxt = UncheckedExtrinsic {
    signature: <span class="hljs-literal">Some</span>((balances::address::Address::Id(pepa), signature, index, era)),
    function: func,
  };

  show_hex_of_extrinsic(&amp;raw_uxt);
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
  ...

  <span class="hljs-comment">/// Print the Extrinsic with Nonce 0 in encoded form where Alice would deploy Smart Contract "Adder" to the Substrate Node</span>
  print_extrinsic(
    &amp;pair,
    GENESIS_BLOCK_HASH,
    <span class="hljs-number">0</span>,
    Call::Contract(contract::Call::create::&lt;Runtime&gt;(<span class="hljs-number">1001</span>.into(), <span class="hljs-number">9_000_000</span>.into(), ADDER_INIT_CODE.to_vec(), <span class="hljs-built_in">Vec</span>::new()))
  );
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="pre-determine-the-contract-address-in-the-substrate-node-s-runtime-that-the-smart-contract-adder-would-be-deployed-to-by-alice-once-submitted"></a><a href="#pre-determine-the-contract-address-in-the-substrate-node-s-runtime-that-the-smart-contract-adder-would-be-deployed-to-by-alice-once-submitted" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-Determine the Contract Address in the Substrate Node's Runtime that the Smart Contract 'Adder' would be deployed to by Alice once Submitted</h4>
<p>We're able to determine upfront what the Contract Address would be in the Substrate Node's Runtime if we were to actually submit an extrinsic containing the Smart Contract 'Adder' sent from Alice. Note that queries do not require a Nonce.</p>
<p>Add the following code to to main.rs.</p>
<pre><code class="hljs css language-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
  ...

  <span class="hljs-comment">/// Pre-Determine upfront the Contract Address in the Substrate Node's Runtime that the Smart Contract 'Adder' would be deployed to by Alice if an extrinsic was submitted</span>
  <span class="hljs-keyword">let</span> addr = &lt;Runtime <span class="hljs-keyword">as</span> contract::Trait&gt;::DetermineContractAddress::contract_address_for(
    &amp;ADDER_INIT_CODE,
    &amp;[],
    &amp;alice,
  );
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="print-the-extrinsic-with-nonce-1-of-a-call-to-a-method-to-increment-storage-by-7-in-the-smart-contract-adder-at-the-pre-determined-contract-address-using-the-encoded-form-of-the-extrinsic"></a><a href="#print-the-extrinsic-with-nonce-1-of-a-call-to-a-method-to-increment-storage-by-7-in-the-smart-contract-adder-at-the-pre-determined-contract-address-using-the-encoded-form-of-the-extrinsic" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Print the Extrinsic with Nonce 1 of a Call to a method to Increment storage by 7 in the Smart Contract 'Adder' at the Pre-Determined Contract Address using the encoded form of the Extrinsic</h4>
<p>We'll use the Contract Address that we pre-determined in the previous step to subsequently pre-determine what the response would be if we were to <code>call</code> a function of the Smart Contract 'Adder'.</p>
<p>We'll <code>call</code> the enum variant <code>Inc(32)</code> of the Smart Contract 'Adder', which <strong>increments</strong> the counter stored in it by a value of 7.</p>
<p>We'll determine the Nonce (index) associated with this <code>call</code> as follows. Assuming Alice were to submit the extrinsic that we previously generated (that would deploy the smart contract) with a Nonce (index) of 0, then if it were to be the case that this <code>call</code> were the next extrinsic that she'd submit, then it'd have a Nonce (index) of 1, so we provide an argument of 1 to <code>print_extrinsic</code>.</p>
<p>We'll pass a function to <code>call</code> the smart contract, and as arguments to the function we'll provide its pre-determined address <code>addr</code>, some funds to send to it <code>1001</code>, a gas limit to allocate <code>9_000_000</code>, and input data <code>vec![0x00, 0x07, 0x00, 0x00, 0x00])</code> representing the value of 7 to increment by.</p>
<p>The input data encodes what method to call (and associated arguments) in the smart contract. In this case it encodes the following:</p>
<ul>
<li>First byte <code>0x00</code> encodes the index of the <code>Action</code>, which corresponds to the <a href="https://github.com/pepyakin/substrate-contracts-adder/blob/master/src/lib.rs#L53">Increment</a> <code>Inc(u32)</code> action of the smart contract.</li>
<li>Last four bytes <code>0x07, 0x00, 0x00, 0x00</code> encodes the <code>u32</code> argument provided to the action, which is a value of 7.</li>
</ul>
<p>Add the following code to to main.rs.</p>
<pre><code class="hljs css language-rust"><span class="hljs-comment">/// Print the Extrinsic with Nonce 1 of a Call to a method to Increment storage by 7 in the Smart Contract 'Adder' at the Pre-Determined Contract Address using the encoded form of the Extrinsic</span>
print_extrinsic(&amp;pair, GENESIS_BLOCK_HASH, <span class="hljs-number">1</span>, Call::Contract(contract::Call::call::&lt;Runtime&gt;(addr, <span class="hljs-number">1001</span>.into(), <span class="hljs-number">9_000_000</span>.into(), <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0x00</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>])));
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="print-the-pre-determined-storage-key-of-the-pre-determined-smart-contract-adder-address-in-substrate-database-storage"></a><a href="#print-the-pre-determined-storage-key-of-the-pre-determined-smart-contract-adder-address-in-substrate-database-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Print the Pre-Determined Storage Key of the Pre-Determined Smart Contract 'Adder' Address in Substrate Database Storage</h4>
<p>We'll pre-determine the Storage Key where the Contract Address of the Smart Contract 'Adder' that we pre-determined earlier would be stored in the Substrate Database Storage.</p>
<p>Add additional dependencies to <strong>Cargo.toml</strong>:</p>
<pre><code class="hljs css language-toml"><span class="hljs-attr">parity-codec</span> = <span class="hljs-string">"2.1"</span>
</code></pre>
<p>Add the following code to to <strong>main.rs</strong>.</p>
<pre><code class="hljs css language-rust"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> parity_codec <span class="hljs-keyword">as</span> codec;

<span class="hljs-keyword">use</span> codec::{Encode};
<span class="hljs-keyword">use</span> primitives::{twox_128, blake2_256};
<span class="hljs-keyword">use</span> node_primitives::{AccountId};

<span class="hljs-keyword">use</span> primitives::hexdisplay::HexDisplay;

<span class="hljs-comment">/// Returns only a first part of the storage key.</span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// Hashed by 128 bit version of xxHash.</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">first_part_of_key</span></span>(k1: AccountId) -&gt; [<span class="hljs-built_in">u8</span>; <span class="hljs-number">16</span>] {
  <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> raw_prefix = <span class="hljs-built_in">Vec</span>::new();
  raw_prefix.extend(<span class="hljs-string">b"con:sto:"</span>);
  raw_prefix.extend(Encode::encode(&amp;k1));
  twox_128(&amp;raw_prefix)
}

<span class="hljs-comment">/// Returns a compound key that consist of the two parts: (prefix, `k1`) and `k2`.</span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// The first part is hashed by xxHash and then concatenated with a 256 bit version of blake2 hash of `k2`.</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">db_key_for_contract_storage</span></span>(k1: AccountId, k2: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">u8</span>&gt;) -&gt; <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">u8</span>&gt; {
  <span class="hljs-keyword">let</span> first_part = first_part_of_key(k1);
  <span class="hljs-keyword">let</span> second_part = blake2_256(&amp;Encode::encode(&amp;k2));

  <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> k = <span class="hljs-built_in">Vec</span>::new();
  k.extend(&amp;first_part);
  k.extend(&amp;second_part);
  k
}

<span class="hljs-built_in">println!</span>(<span class="hljs-string">"DB Storage Key of Smart Contract code:"</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"0x{}"</span>, HexDisplay::from(&amp;db_key_for_contract_storage(addr.clone(), [<span class="hljs-number">1u8</span>; <span class="hljs-number">32</span>].to_vec())));
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="submit-the-extrinsic-with-nonce-0-using-json-rpc-and-curl-to-deploy-smart-contract-adder-to-substrate-node"></a><a href="#submit-the-extrinsic-with-nonce-0-using-json-rpc-and-curl-to-deploy-smart-contract-adder-to-substrate-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submit the Extrinsic with Nonce 0 using JSON-RPC and cURL to deploy Smart Contract 'Adder' to Substrate Node</h4>
<p><strong>FIXME</strong> - do we need actually use JSON-RPC using cURL to deploy the Smart Contract with Nonce 0?</p>
<p>We'll submit our 1st extrinsic by providing values for members of a JSON-RPC call including method <code>author_submitExtrinsic</code> and params <code>[&quot;&lt;INSERT_EXTRINSIC_NONCE_0_HASH&gt;&quot;]</code> using cURL</p>
<pre><code class="hljs css language-shell">curl -H 'Content-Type: application/json' \\
    -d '{ "jsonrpc": "2.0", "method": "author_submitExtrinsic", "params": ["&lt;INSERT_EXTRINSIC_NONCE_0_HASH&gt;"], "id": 0 }' \\
    -vv http://localhost:9933/
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="check-pending-extrinsics-until-extrinsic-with-nonce-0-is-submitted"></a><a href="#check-pending-extrinsics-until-extrinsic-with-nonce-0-is-submitted" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Check Pending Extrinsics until Extrinsic with Nonce 0 is Submitted</h4>
<p>We learnt earlier that we've got to be quick at querying to see an extrinsic in the 'pending' extrinsics queue before it's submitted. Let's try it again, providing values for members of a JSON-RPC call including method <code>author_pendingExtrinsics</code> and params <code>[]</code> using cURL.</p>
<p>Initially in the JSON-RPC's response the <code>result</code> value will be an array containing the extrinsic hash as its value <code>[&quot;&lt;INSERT_EXTRINSIC_NONCE_0_HASH&gt;&quot;]</code>. However, we'll repeating the command until the <code>result</code> value is an empty array <code>[]</code> in the value returned of <code>{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;: [], &quot;id&quot;: 1 }</code> to confirm that the extrinsic was executed.</p>
<pre><code class="hljs css language-shell">curl -H 'Content-Type: application/json' \\
    -d '{ "jsonrpc": "2.0", "method": "author_pendingExtrinsics", "params": [], "id": 0 }' \\
    -vv http://localhost:9933/
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="verify-extrinsic-with-nonce-0-was-submitted"></a><a href="#verify-extrinsic-with-nonce-0-was-submitted" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify Extrinsic with Nonce 0 was Submitted</h4>
<p>We'll verify that the extrinsic with Nonce 0 was actually submitted, such that the Smart Contract 'Adder' was actually deployed.</p>
<p>Let's create another JSON-RPC call, and provide values for members including method <code>state_getStorage</code> and params <code>[&quot;&lt;INSERT_DB_STORAGE_KEY_OF_SMART_CONTRACT&gt;&quot;]</code> using cURL.</p>
<p>In the JSON-RPC's response the <code>result</code> value is <code>0x1001000000</code> in the value returned of <code>{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;: &quot;0x1001000000, &quot;id&quot;: 0 }</code>. It corresponds to a value of 1 in little endian (LE) format <code>1000000</code>, which is the length of the data, and means that it worked</p>
<pre><code class="hljs css language-shell">curl -H 'Content-Type: application/json' \\
    -d '{ "jsonrpc": "2.0", "method": "state_getStorage", "params": ["&lt;INSERT_DB_STORAGE_KEY_OF_SMART_CONTRACT&gt;"], "id": 0 }' \\
    -vv http://localhost:9933/
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="verify-the-current-nonce-of-an-account-id"></a><a href="#verify-the-current-nonce-of-an-account-id" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify the Current Nonce of an Account ID</h4>
<p><strong>TODO</strong>: Show how to obtain accountNonce for an Account ID using Polkadot-JS Apps using Chain State &gt; system &gt; accountNonce. Also how to obtain it in the web browser inspector using the Substrate UI</p>
<p><strong>FIXME</strong>: Update screenshot below:
<img src="https://files.readme.io/34fe214-Screen_Shot_2018-11-15_at_00.22.44.png" alt="todo"></p>
<h4><a class="anchor" aria-hidden="true" id="submit-the-extrinsic-with-nonce-1-using-json-rpc-with-curl"></a><a href="#submit-the-extrinsic-with-nonce-1-using-json-rpc-with-curl" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submit the Extrinsic with Nonce 1 using JSON-RPC with cURL</h4>
<p>We'll submit our extrinsic with Nonce 1 by providing values for members of a JSON-RPC call including method <code>author_submitExtrinsic</code> and params <code>[&quot;&lt;INSERT_EXTRINSIC_NONCE_1_HASH&gt;&quot;]</code> using cURL</p>
<pre><code class="hljs css language-shell">curl -H 'Content-Type: application/json' \\
    -d '{ "jsonrpc": "2.0", "method": "author_submitExtrinsic", "params": ["&lt;INSERT_EXTRINSIC_NONCE_1_HASH&gt;"], "id": 0 }' \\
    -vv http://localhost:9933/
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="check-pending-extrinsics-until-extrinsic-with-nonce-1-is-submitted"></a><a href="#check-pending-extrinsics-until-extrinsic-with-nonce-1-is-submitted" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Check Pending Extrinsics until Extrinsic with Nonce 1 is Submitted</h4>
<p>Repeat the previous step but this time to confirm that Nonce 1 was submitted.</p>
<h4><a class="anchor" aria-hidden="true" id="verify-extrinsic-with-nonce-1-was-submitted"></a><a href="#verify-extrinsic-with-nonce-1-was-submitted" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify Extrinsic with Nonce 1 was Submitted</h4>
<p>We'll verify that the extrinsic with Nonce 1 was actually submitted, such that the Smart Contract 'Adder' storage was incremented by 7.</p>
<p>Let's provide values for members of a JSON-RPC call including method <code>state_getStorage</code> and params <code>[&quot;&lt;INSERT_DB_STORAGE_KEY_OF_SMART_CONTRACT&gt;&quot;]</code> using cURL. In the JSON-RPC's response the <code>result</code> value is <code>0x1007000000</code> in the value returned of <code>{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;: &quot;0x1007000000, &quot;id&quot;: 0 }</code>. It corresponds to a value of 1 in little endian (LE) format <code>7000000</code>, which means that it successfully incremented the storage by a value of 7.</p>
<pre><code class="hljs css language-shell">curl -H 'Content-Type: application/json' \\
    -d '{ "jsonrpc": "2.0", "method": "state_getStorage", "params": ["&lt;INSERT_DB_STORAGE_KEY_OF_SMART_CONTRACT&gt;"], "id": 0 }' \\
    -vv http://localhost:9933/
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="step-8-deploy-and-call-smart-contract-adder-to-substrate-node-using-javascript-promises-and-rxjs"></a><a href="#step-8-deploy-and-call-smart-contract-adder-to-substrate-node-using-javascript-promises-and-rxjs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 8: Deploy and Call Smart Contract &quot;Adder&quot; to Substrate Node using JavaScript Promises and RxJS</h2>
<p><strong>TODO</strong>: We're in the process of adding this to the <a href="https://polkadot.js.org/api/">Examples section of Polkadot-JS API Docs</a> in <a href="https://github.com/polkadot-js/api/pull/331">PR#331</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/tutorials/creating-a-custom-substrate-chain"><span class="arrow-prev">← </span><span>Creating a Custom Substrate chain</span></a><a class="docs-next button" href="/docs/en/tutorials/start-a-private-network-with-substrate"><span>Start a Private Network with Substrate</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a><ul class="toc-headings"><li><a href="#setup-directories-for-code">Setup Directories for Code</a></li><li><a href="#setup-substrate-node-and-substrate-ui">Setup Substrate Node and Substrate UI</a></li><li><a href="#view-and-run-the-rust-program-demo">View and Run the Rust Program Demo</a></li></ul></li><li><a href="#step-1-integrate-substrate-srml-contracts-module-into-substrate-node-runtime">Step 1: Integrate Substrate SRML 'Contracts' Module into Substrate Node Runtime</a></li><li><a href="#step-2-launch-a-substrate-node-blockchain">Step 2: Launch a Substrate Node Blockchain</a></li><li><a href="#step-3-launch-ui-of-polkadot-js-apps">Step 3: Launch UI of Polkadot-JS Apps</a></li><li><a href="#step-4-obtain-block-hash-of-genesis-block-using-json-rpc">Step 4: Obtain Block Hash of Genesis Block using JSON-RPC</a><ul class="toc-headings"><li><a href="#option-1-interact-with-polkadot-js-apps">Option 1: Interact with Polkadot-JS Apps</a></li><li><a href="#option-2-interact-using-curl">Option 2: Interact using cURL</a></li></ul></li><li><a href="#step-5-about-the-smart-contract-adder-rust-program">Step 5: About the Smart Contract 'Adder' Rust program</a></li><li><a href="#step-6-generate-wasm-file-from-smart-contract-adder-rust-program">Step 6: Generate WASM file from Smart Contract 'Adder' Rust program</a></li><li><a href="#step-7-create-extrinsic-and-deploy-smart-contract-adder-to-substrate-node">Step 7: Create Extrinsic and Deploy Smart Contract 'Adder' to Substrate Node</a><ul class="toc-headings"><li><a href="#option-1-interact-using-ui-of-polkadot-js-apps-easy">Option 1: Interact using UI of Polkadot-JS Apps (Easy)</a></li><li><a href="#option-2-write-rust-program-advanced-a-name-write-rust-program-a">Option 2: Write Rust Program (Advanced) &lt;a name=&quot;write-rust-program&quot;&gt;&lt;/a&gt;</a></li></ul></li><li><a href="#step-8-deploy-and-call-smart-contract-adder-to-substrate-node-using-javascript-promises-and-rxjs">Step 8: Deploy and Call Smart Contract &quot;Adder&quot; to Substrate Node using JavaScript Promises and RxJS</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/en/who">Getting Started</a><a href="/en/tutorials">Tutorials</a><a href="https://crates.parity.io">Reference Docs</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/paritytech/substrate">GitHub</a><a class="github-button" href="https://github.com/substrate-developer-hub/substrate-developer-hub.github.io" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Parity Technologies</section></footer></div></body></html>